<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Carrito - TechNova</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/estilos.css">
</head>
<body class="neumorphic-body">

  <nav class="navbar neumorphic-nav">
    <div class="container">
      <a class="navbar-brand neumorphic-title" href="/vistas/cliente/catalogo.html">TechNova</a>
      <div class="ms-auto">
        <a href="/vistas/cliente/login.html" class="nav-link neumorphic-link d-none" id="loginLink">Iniciar Sesión</a>
        <span id="welcomeUser" class="nav-link text-neon-cyan d-none">Bienvenido, <strong id="userName"></strong></span>
      </div>
    </div>
  </nav>

  <div class="container py-5">
    <h2 class="text-center mb-5 neumorphic-title">Tu Carrito</h2>

    <div id="carrito-container" class="row g-4 mb-5"></div>

    <div class="neumorphic-card p-4">
      <div class="d-flex justify-content-between mb-3">
        <h5>Subtotal</h5>
        <h5 id="subtotal">$0.00</h5>
      </div>
      <div class="d-flex justify-content-between mb-3">
        <h5>Envío</h5>
        <h5>$0.00</h5>
      </div>
      <hr>
      <div class="d-flex justify-content-between">
        <h4>Total</h4>
        <h4 id="total">$0.00</h4>
      </div>
      <button id="vaciar-carrito" class="neumorphic-btn btn-outline mt-4 me-2">Vaciar Carrito</button>
      <a href="/vistas/cliente/checkout.html" id="finalizar-compra" class="neumorphic-btn mt-4">Finalizar Compra</a>
    </div>
  </div>

  <script>
    function actualizarCarrito() {
      const carrito = JSON.parse(localStorage.getItem('carrito')) || [];
      const container = document.getElementById('carrito-container');
      container.innerHTML = '';

      if (carrito.length === 0) {
        container.innerHTML = '<p class="text-center text-muted fs-5">Tu carrito está vacío</p>';
        document.getElementById('subtotal').textContent = '$0.00';
        document.getElementById('total').textContent = '$0.00';
        return;
      }

      let subtotal = 0;

      carrito.forEach((item, index) => {
        subtotal += item.precio * item.cantidad;

        const card = `
          <div class="col-12">
            <div class="neumorphic-card p-3 d-flex align-items-center">
              <img src="${item.imagen}" alt="${item.nombre}" style="width: 100px; height: 100px; object-fit: cover; border-radius: 12px;">
              <div class="ms-4 flex-grow-1">
                <h5>${item.nombre}</h5>
                <p class="text-success fw-bold">$${item.precio.toLocaleString()} c/u</p>
              </div>
              <div class="d-flex align-items-center gap-3">
                <button class="btn btn-sm neumorphic-btn" onclick="cambiarCantidad(${index}, -1)">-</button>
                <span class="fs-5">${item.cantidad}</span>
                <button class="btn btn-sm neumorphic-btn" onclick="cambiarCantidad(${index}, 1)">+</button>
                <button class="btn btn-sm btn-danger ms-3" onclick="eliminarProducto(${index})">Eliminar</button>
              </div>
            </div>
          </div>
        `;
        container.innerHTML += card;
      });

      document.getElementById('subtotal').textContent = `$${subtotal.toLocaleString()}`;
      document.getElementById('total').textContent = `$${subtotal.toLocaleString()}`;
    }

    function cambiarCantidad(index, cambio) {
      let carrito = JSON.parse(localStorage.getItem('carrito')) || [];
      carrito[index].cantidad += cambio;
      if (carrito[index].cantidad < 1) carrito[index].cantidad = 1;
      localStorage.setItem('carrito', JSON.stringify(carrito));
      actualizarCarrito();
    }

    function eliminarProducto(index) {
      let carrito = JSON.parse(localStorage.getItem('carrito')) || [];
      carrito.splice(index, 1);
      localStorage.setItem('carrito', JSON.stringify(carrito));
      actualizarCarrito();
    }

    document.getElementById('vaciar-carrito').addEventListener('click', () => {
      if (confirm('¿Vaciar todo el carrito?')) {
        localStorage.removeItem('carrito');
        actualizarCarrito();
      }
    });

    // Mostrar nombre si está logueado
    const nombre = localStorage.getItem('nombre');
    if (nombre) {
      document.getElementById('loginLink').classList.add('d-none');
      document.getElementById('welcomeUser').classList.remove('d-none');
      document.getElementById('userName').textContent = nombre;
    }

    // Cargar carrito al abrir
    actualizarCarrito();
  </script>
</body>
</html>